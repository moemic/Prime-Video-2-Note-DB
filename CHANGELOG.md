# Changelog

すべての主要な変更と新機能の履歴をここに記録します。

## [1.23.0] - 2026-02-21
### Added
- **サイドパネル表示モードの追加**: 拡張機能の表示先を「ポップアップ」と「サイドパネル」から選択できるようになりました。Settings パネル内の「表示モード」で切り替え可能です。サイドパネルモードではブラウザ横に常駐パネルが表示され、Prime Video の画面を見ながら入力できます。
- **`sidePanel` パーミッションの追加**: Chrome Side Panel API を使用するための権限を manifest.json に追加しました。
### Changed
- **ステータスのフォールバック廃止**: ステータス未選択時に「鑑賞終了」が自動設定される挙動を廃止しました。ステータスを選ばなければ空欄（既存ページは既存値を維持）のまま保存されます。

## [1.22.0] - 2026-02-21
### Changed
- **コメントUIを2セクションに分離**: 既存のNotionコメントは「既存コメント」として読み取り専用エリアに表示し、新規コメントは別の入力欄から投稿する形に変更しました。これにより、既存コメントの二重投稿が構造的に発生しなくなりました。
- **保存ロジックの簡素化**: 新規コメント入力欄の内容をそのまま送信するシンプルな仕組みに変更し、既存コメントとの比較処理（loadedComment）を廃止しました。
- **重複警告と類似候補の同時表示**: 完全一致（ASIN/タイトル）が見つかった場合でも、類似タイトルの候補リストを併せて表示するようにしました。「もしかしてこれですか？」の候補が常に確認できます。

## [1.21.0] - 2026-02-21
### Added
- **エピソードサムネイル（covershot）の読み込み対応**: シリーズ作品の各話サムネイルを画像候補として取得できるようになりました。packshot > titleshot > heroshot > covershot の優先順で表示されます。
- **既存ページのコメントを読み込み表示**: 登録済みページを検出した際、Notionに保存されているコメントを自動取得してコメント欄に表示するようになりました。複数のコメントは `---` 区切りで結合して表示します。
- **類似タイトル候補の表示機能を復元**: ASINや完全一致で検出されない場合でも、類似度の高い作品をリストアップして表示する機能を復元しました。「これを使う」ボタンで選択すると既存データを読み込みます。

## [1.20.0] - 2026-02-21
### Added
- **プロパティ用とページカバー用の画像を別々に選択可能に**: カルーセルで選択した画像を「カバー画像プロパティ用」と「ページカバー用」に独立して指定できるようになりました。

## [1.12.0] - 2026-02-21
### Changed
- **「著者」プロパティを「監督」に改称**: Notion データベース側のプロパティ名を「著者」から「監督」に変更しました。既存のデータベースをお使いの方は、Notion 側のプロパティ名も合わせて変更してください。
- **初期ステータスのハードコード廃止**: 起動時に「鑑賞終了」が自動選択される挙動を廃止しました。Notion データベースに設定されたステータス候補からのみ選択できるようになりました。
- **ハードコードされた Database ID の除去**: 開発者個人の Notion Database ID がコードに埋め込まれていた問題を修正し、初回起動時は空欄になるよう変更しました。

### Added
- **初回起動時の設定パネル自動展開**: Notion Token または Database ID が未設定の場合、起動時に自動で設定パネルが開くようになりました。
- **設定パネルのガイド表示強化**: 設定パネル内に「何をどこで取得すればよいか」を示すヒントテキストを追加しました。
- **README にセットアップ手順を追加**: Notion インテグレーションの作り方・データベーススキーマの準備・Token と Database ID の登録方法を詳細に記載しました。

### Fixed
- **バージョン番号の不一致を解消**: `manifest.json`・`popup.js`・`popup.html` で異なっていたバージョン表記を `1.12.0` に統一しました。

## [1.7.0] - 2026-02-08
### Added
- **サムネイル候補のサイズ順ソート**: 抽出された画像をファイルサイズの大きい（高画質な）順に並び替えて表示するようにしました。ポスター画像などが優先的に選択しやすくなります。

## [1.6.0] - 2026-02-08
### Added
- **監督名の自動保存**: Prime Videoから監督名を抽出し、Notionの「著者」プロパティに保存する機能を実装しました。
- **登録日の自動保存**: 保存ボタンを押した際、その日の日付をNotionの「日付」プロパティに自動設定するようにしました。

## [1.5.0] - 2026-02-08
### Added
- **既存データの自動読み込み**: 重複登録時に、Notionから既存のオススメ度、ジャンル、概要を自動で取得してUIに反映する機能を実装しました。
- **既存ページの上書き更新（PATCH）**: すでに登録済みの作品を保存する場合、新規作成ではなく既存ページを更新するようにロジックを強化しました。

## [1.4.0] - 2026-02-08
### Added
- **重複登録チェック機能**: ポップアップ起動時にNotionデータベースを自動検索し、同じ作品が既に登録されている場合に警告とリンクを表示する機能を実装しました。
- **動的再チェック**: ユーザーがタイトルを手動編集した際も、即座に既存登録の有無を確認するように改善しました。

## [1.3.0] - 2026-02-08
### Added
- **既存タグの取得と選択機能**: Notionデータベースの「ジャンル」プロパティから既存のタグを自動取得し、クリックで簡単に選択できるUI（チップ形式）を実装しました。
- **タグの即時同期**: チップのクリックと手動入力によるタグ追加がリアルタイムで同期し、選択状態が視覚的にフィードバックされるようになりました。

## [1.2.0] - 2026-02-08
### Fixed
- **ネイティブコメント機能の正式公開**: Notion側の権限不足エラーを特定・解消し、感想がNotionの純正コメント欄に保存される機能が正式に有効になりました。
### Changed
- **UI/UXのクリーンアップ**: デバッグ用の検証マーカー（タイトルへの `[v1.1.4]` 付与）や詳細ログ出力を削除し、製品版として最適化しました。

## [1.1.4] - 2026-02-08
### Added
- **検証用マーカーの追加**: 確実に最新版が動作しているか確認するため、Notionに登録されるタイトルに `[v1.1.4]` が自動付与されるようにしました。挙動が修正された後、このマーカーは削除します。

## [1.1.3] - 2026-02-08
### Added
- **詳細デバッグ情報の追加**: 確実にNativeコメント機能を追跡するため、バックグラウンドでの全ペイロード記録と、コメントAPIのレスポンス判定（エラーメッセージの取得）を追加しました。
### Changed
- **進捗表示の強化**: ポップアップでの保存中ステータスをより細かく更新するように改善しました。

## [1.1.2] - 2026-02-08
### Added
- **デバッグ情報の追加**: ポップアップにバージョン番号を表示し、バックグラウンドスクリプトにログ出力を追加しました。
### Changed
- **UIラベルの改善**: 「概要」と「コメント」の保存先（プロパティか純正コメント欄か）を明示的に表記するように変更しました。

## [1.1.1] - 2026-02-08
### Fixed
- **コメント機能の修正**: Notion へのコメント保存先を、ページ本文（ノート部分）から Notion 本来の「コメント機能」に変更しました。

## [1.1.0] - 2026-02-08
### Added
- **複数画像の同時保存**: 抽出されたすべての画像を Notion の「ファイル」プロパティに一括保存する機能を追加。
- **イメージセレクター**: カルーセル形式で保存したいカバー画像を 1 枚選択できる UI を実装。
- **高度な画像抽出ロジック**: LD-JSON や Amazon ストアテンプレートからポスター画像（パックショット）を優先的に抽出する機能。
- **Git 自動バックアップワークフロー**: 開発完了時に自動で GitHub へ Push する仕組みを導入。

### Changed
- **UI リデザイン**: Obsidian 拡張機能に近い、ダークモード基調のリッチな UI へ刷新。
- **コメント・タグ・評価**: Notion のプロパティ（コメント、マルチセレクト、セレクト）へ対応。

## [1.0.0] - 2026-02-07
### Added
- **初版リリース**: Prime Video からタイトル、概要、URL、サムネイルを抽出して Notion へ保存する基本機能を実装。
